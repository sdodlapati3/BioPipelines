# BioPipelines - Component Walkthrough Guide

**Purpose:** Detailed technical walkthrough of each component from query entry to result visualization.

---

## Table of Contents

1. [Query Entry & Parsing](#1-query-entry--parsing)
2. [Intent Understanding & Validation](#2-intent-understanding--validation)
3. [Tool Selection & Module Mapping](#3-tool-selection--module-mapping)
4. [Workflow Generation](#4-workflow-generation)
5. [Data Preparation](#5-data-preparation)
6. [Pipeline Execution](#6-pipeline-execution)
7. [Monitoring & Status](#7-monitoring--status)
8. [Result Analysis](#8-result-analysis) âš ï¸ NEEDS IMPLEMENTATION
9. [Visualization](#9-visualization) âš ï¸ NEEDS IMPLEMENTATION

---

## 1. Query Entry & Parsing

### 1.1 Entry Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Query Entry Points                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Gradio UI   â”‚  â”‚  REST API    â”‚  â”‚     CLI      â”‚       â”‚
â”‚  â”‚  (Primary)   â”‚  â”‚  (FastAPI)   â”‚  â”‚  (argparse)  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                            â–¼                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚   Composer   â”‚                          â”‚
â”‚                    â”‚  (Main API)  â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Query Examples

| Query Type | Example | Complexity |
|------------|---------|------------|
| Simple | "RNA-seq for mouse" | Low |
| Detailed | "ChIP-seq peak calling for H3K4me3 in human ES cells" | Medium |
| Complex | "Compare RNA-seq between treated and control samples with DESeq2, mouse GRCm39, paired-end" | High |

### 1.3 Code Flow

```python
# src/workflow_composer/web/gradio_app.py

def chat_with_composer(message: str, history: list) -> Tuple[list, str]:
    """Process user query and generate workflow."""
    
    # 1. Get LLM adapter
    llm = app_state.get_llm()
    
    # 2. Parse intent (determine what user wants)
    intent = app_state.composer.parse_intent(message)
    
    # 3. Check for workflow generation trigger
    if intent.analysis_type and intent.confidence > 0.5:
        # Generate workflow
        workflow = app_state.composer.generate(message, output_dir=output_dir)
```

### 1.4 Current Limitations

- âŒ No spell correction for organism/tool names
- âŒ No auto-complete/suggestions
- âŒ No query history

### 1.5 Proposed Improvements

```python
# PROPOSED: Enhanced query preprocessing

class QueryPreprocessor:
    """Preprocess and enhance user queries."""
    
    def __init__(self):
        self.organism_aliases = {
            "human": ["homo sapiens", "h. sapiens", "hsa"],
            "mouse": ["mus musculus", "m. musculus", "mmu"],
        }
        self.tool_corrections = {
            "deseq": "DESeq2",
            "star aligner": "STAR",
        }
    
    def preprocess(self, query: str) -> str:
        """Normalize and enhance query."""
        query = self._normalize_organisms(query)
        query = self._normalize_tools(query)
        return query
```

---

## 2. Intent Understanding & Validation

### 2.1 Intent Parser Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Intent Parsing Pipeline                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Query   â”‚â”€â”€â”€â–¶â”‚   LLM Parser    â”‚â”€â”€â”€â–¶â”‚ ParsedIntent  â”‚   â”‚
â”‚  â”‚  String  â”‚    â”‚ (Structured)    â”‚    â”‚   Object      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                      â”‚            â”‚
â”‚                          â”‚ OR (Ensemble)        â”‚            â”‚
â”‚                          â–¼                      â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Ensemble Parser (Optional - Higher Accuracy)           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚  BioMistral  â”‚ â”‚  BiomedBERT  â”‚ â”‚   SciBERT    â”‚    â”‚â”‚
â”‚  â”‚  â”‚  (Intent)    â”‚ â”‚  (Entities)  â”‚ â”‚  (Terms)     â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ParsedIntent Structure

```python
@dataclass
class ParsedIntent:
    """Parsed user intent from natural language."""
    
    # Core identification
    analysis_type: AnalysisType      # e.g., RNA_SEQ_DE
    confidence: float                 # 0.0 - 1.0
    
    # Biological context
    organism: Optional[str]           # e.g., "mouse"
    genome_build: Optional[str]       # e.g., "GRCm39"
    data_type: Optional[str]          # e.g., "paired-end RNA-seq"
    
    # Experimental design
    paired_end: bool                  # True/False
    has_comparison: bool              # Has conditions to compare
    conditions: List[str]             # e.g., ["treated", "control"]
    
    # Extracted entities
    tools_mentioned: List[str]        # e.g., ["STAR", "DESeq2"]
    parameters: Dict[str, Any]        # Custom parameters
    
    # Original query
    original_query: str
```

### 2.3 Validation Steps

```python
# CURRENT: Basic validation
if intent.confidence < 0.5:
    return "I'm not sure what analysis you want. Could you clarify?"

# PROPOSED: Comprehensive validation
class IntentValidator:
    """Validate parsed intent against system capabilities."""
    
    def validate(self, intent: ParsedIntent) -> ValidationResult:
        errors = []
        warnings = []
        
        # 1. Check if analysis type is supported
        if intent.analysis_type not in SUPPORTED_ANALYSES:
            errors.append(f"Analysis type not supported: {intent.analysis_type}")
        
        # 2. Check if required tools are available
        for tool in intent.tools_mentioned:
            if not self.tool_selector.has_tool(tool):
                warnings.append(f"Tool may not be available: {tool}")
        
        # 3. Check if reference data exists
        if intent.organism and intent.genome_build:
            if not self.data_manager.has_reference(intent.organism, intent.genome_build):
                warnings.append(f"Reference may need download: {intent.organism}/{intent.genome_build}")
        
        return ValidationResult(errors=errors, warnings=warnings)
```

---

## 3. Tool Selection & Module Mapping

### 3.1 Tool Selection Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Tool Selection Pipeline                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚AnalysisTypeâ”‚â”€â”€â”€â–¶â”‚ Analysisâ†’Tools  â”‚â”€â”€â”€â–¶â”‚  Tool List   â”‚  â”‚
â”‚  â”‚            â”‚    â”‚     Mapping     â”‚    â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                   â”‚          â”‚
â”‚                                                   â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   Tool Catalog                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚ QC:         FastQC, MultiQC, Fastp, Trim_Galore    â”‚â”‚â”‚
â”‚  â”‚  â”‚ Alignment:  STAR, HISAT2, BWA, Bowtie2, Minimap2   â”‚â”‚â”‚
â”‚  â”‚  â”‚ Quant:      featureCounts, Salmon, kallisto        â”‚â”‚â”‚
â”‚  â”‚  â”‚ Variants:   GATK, bcftools, FreeBayes, DeepVariant â”‚â”‚â”‚
â”‚  â”‚  â”‚ Peaks:      MACS2, HOMER, SICER                    â”‚â”‚â”‚
â”‚  â”‚  â”‚ scRNA:      STARsolo, Cellranger, Scanpy           â”‚â”‚â”‚
â”‚  â”‚  â”‚ Meta:       Kraken2, MetaPhlAn, MEGAHIT            â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Analysis â†’ Tools Mapping

```python
# src/workflow_composer/core/tool_selector.py

ANALYSIS_TOOLS = {
    AnalysisType.RNA_SEQ_DE: {
        "qc": ["FastQC", "Fastp"],
        "alignment": ["STAR"],
        "quantification": ["featureCounts", "Salmon"],
        "analysis": ["DESeq2"],
        "reporting": ["MultiQC"]
    },
    AnalysisType.CHIP_SEQ: {
        "qc": ["FastQC"],
        "alignment": ["Bowtie2", "BWA"],
        "peak_calling": ["MACS2"],
        "annotation": ["HOMER"],
        "reporting": ["MultiQC"]
    },
    # ... more mappings
}
```

### 3.3 Module Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Module Mapping Pipeline                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Tool      â”‚â”€â”€â”€â–¶â”‚ Toolâ†’Module Map â”‚â”€â”€â”€â–¶â”‚   Module     â”‚  â”‚
â”‚  â”‚  (STAR)    â”‚    â”‚   (Registry)    â”‚    â”‚  (Nextflow)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                   â”‚          â”‚
â”‚                                                   â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Nextflow Module Structure                  â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚  nextflow-pipelines/modules/                            â”‚â”‚
â”‚  â”‚  â”œâ”€â”€ alignment/                                         â”‚â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ star/main.nf          â† STAR_ALIGN process    â”‚â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ bwa/main.nf           â† BWA_MEM process       â”‚â”‚
â”‚  â”‚  â”‚   â””â”€â”€ bowtie2/main.nf       â† BOWTIE2_ALIGN process â”‚â”‚
â”‚  â”‚  â”œâ”€â”€ qc/                                                â”‚â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ fastqc/main.nf        â† FASTQC process        â”‚â”‚
â”‚  â”‚  â”‚   â””â”€â”€ multiqc/main.nf       â† MULTIQC process       â”‚â”‚
â”‚  â”‚  â””â”€â”€ quantification/                                    â”‚â”‚
â”‚  â”‚      â”œâ”€â”€ salmon/main.nf        â† SALMON_QUANT process  â”‚â”‚
â”‚  â”‚      â””â”€â”€ featurecounts/main.nf â† FEATURECOUNTS process â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Workflow Generation

### 4.1 Generation Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Workflow Generation Strategy                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Priority 1: File-Based Templates (Most Reliable)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ nextflow-pipelines/templates/                           â”‚â”‚
â”‚  â”‚ â”œâ”€â”€ chipseq_template.nf    âœ… Tested, parameterized     â”‚â”‚
â”‚  â”‚ â”œâ”€â”€ rnaseq_template.nf     âœ… Tested, parameterized     â”‚â”‚
â”‚  â”‚ â””â”€â”€ ...                                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼ (if not found)                    â”‚
â”‚  Priority 2: Embedded Templates                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ WORKFLOW_TEMPLATES dict in workflow_generator.py       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼ (if not found)                    â”‚
â”‚  Priority 3: LLM Generation (Flexible, Less Reliable)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Generate via LLM prompt with module info                â”‚â”‚
â”‚  â”‚ âš ï¸ May produce incorrect paths                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼ (if no LLM)                       â”‚
â”‚  Priority 4: Generic Template                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Minimal workflow skeleton                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Generated Workflow Package

```
generated_workflows/
â””â”€â”€ rnaseq_de_mouse_20251125_123456/
    â”œâ”€â”€ main.nf              # Main Nextflow workflow
    â”œâ”€â”€ nextflow.config      # Execution configuration
    â”œâ”€â”€ samplesheet.csv      # Sample metadata template
    â”œâ”€â”€ README.md            # Usage instructions
    â”œâ”€â”€ modules/             # (empty, uses symlink)
    â””â”€â”€ logs/                # Execution logs (created at runtime)
```

### 4.3 Template Customization

```python
# Template with placeholders
template_content = """
/*
 * {{ANALYSIS_TYPE}} Workflow
 * Organism: {{ORGANISM}}
 * Genome: {{GENOME_BUILD}}
 * Generated: {{DATE}}
 */

params.reads = "${projectDir}/data/*_R{1,2}.fastq.gz"
params.genome = "${projectDir}/references/{{GENOME_BUILD}}/genome.fa"
params.single_end = {{SINGLE_END}}
"""

# Customization
params = {
    "ANALYSIS_TYPE": "RNA-seq Differential Expression",
    "ORGANISM": "mouse",
    "GENOME_BUILD": "GRCm39",
    "DATE": "2025-11-25",
    "SINGLE_END": "false"
}

main_nf = template.customize(params)
```

---

## 5. Data Preparation

### 5.1 Data Management Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Data Management System                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                Reference Data Sources                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚ Ensembl  â”‚ â”‚ GENCODE  â”‚ â”‚   UCSC   â”‚ â”‚ iGenomes â”‚   â”‚â”‚
â”‚  â”‚  â”‚ Genomes  â”‚ â”‚ Annots   â”‚ â”‚ Genomes  â”‚ â”‚ Indexes  â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  DataDownloader                         â”‚â”‚
â”‚  â”‚  â€¢ get_genome(organism, assembly)                       â”‚â”‚
â”‚  â”‚  â€¢ get_annotation(organism, assembly)                   â”‚â”‚
â”‚  â”‚  â€¢ get_index(aligner, organism, assembly)               â”‚â”‚
â”‚  â”‚  â€¢ get_sample_dataset(name)                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Local Cache                            â”‚â”‚
â”‚  â”‚  ~/.biopipelines/references/                            â”‚â”‚
â”‚  â”‚  â”œâ”€â”€ ensembl/                                           â”‚â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ human/GRCh38.genome.fa.gz                     â”‚â”‚
â”‚  â”‚  â”‚   â””â”€â”€ mouse/GRCm39.annotation.gtf.gz                â”‚â”‚
â”‚  â”‚  â”œâ”€â”€ indexes/                                           â”‚â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ star/human_GRCh38/                            â”‚â”‚
â”‚  â”‚  â”‚   â””â”€â”€ bwa/mouse_GRCm39/                             â”‚â”‚
â”‚  â”‚  â””â”€â”€ manifest.json                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Missing: UI Integration

```python
# PROPOSED: Data Browser Component for Gradio UI

class DataBrowserUI:
    """UI component for data management."""
    
    def render(self) -> gr.Column:
        with gr.Column() as data_browser:
            gr.Markdown("## ğŸ“ Data Browser")
            
            with gr.Tab("Reference Data"):
                organism = gr.Dropdown(
                    choices=["human", "mouse", "zebrafish"],
                    label="Organism"
                )
                assembly = gr.Dropdown(
                    choices=[],  # Populated based on organism
                    label="Assembly"
                )
                download_btn = gr.Button("Download Reference")
                status = gr.Markdown()
            
            with gr.Tab("Sample Data"):
                gr.Markdown("Available test datasets:")
                datasets = gr.Dataframe(
                    headers=["Name", "Description", "Size"],
                    value=self._list_sample_datasets()
                )
            
            with gr.Tab("My Data"):
                gr.Markdown("Upload or register your data:")
                upload = gr.File(label="Upload FASTQ files")
                # Or register existing paths
                path_input = gr.Textbox(label="Path to existing data")
        
        return data_browser
```

---

## 6. Pipeline Execution

### 6.1 Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Pipeline Execution Flow                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  User clicks "Submit"                                        â”‚
â”‚         â”‚                                                    â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ Validate     â”‚ Check workflow exists, params valid        â”‚
â”‚  â”‚ Workflow     â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚         â”‚                                                    â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ Generate     â”‚ Create SLURM batch script                  â”‚
â”‚  â”‚ SBATCH       â”‚ with Nextflow command                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚         â”‚                                                    â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ Submit to    â”‚ sbatch run_job_xxx.sbatch                  â”‚
â”‚  â”‚ SLURM        â”‚ Returns SLURM job ID                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚         â”‚                                                    â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ Start        â”‚ Background thread monitors                 â”‚
â”‚  â”‚ Monitor      â”‚ job status every 5 seconds                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 SBATCH Script Generation

```bash
#!/bin/bash
#SBATCH --job-name=nf_rnaseq_workflow
#SBATCH --output=logs/slurm_%j.out
#SBATCH --error=logs/slurm_%j.err
#SBATCH --time=48:00:00
#SBATCH --mem=8G
#SBATCH --cpus-per-task=2
#SBATCH --partition=cpuspot

# Load required modules
module load nextflow 2>/dev/null || true
module load singularity 2>/dev/null || true

# Activate conda if available
source ~/miniconda3/etc/profile.d/conda.sh 2>/dev/null || true
conda activate biopipelines 2>/dev/null || true

# Change to workflow directory
cd /path/to/generated_workflows/rnaseq_xxx

# Run Nextflow
nextflow run main.nf \
    -profile slurm,singularity \
    -with-report logs/report.html \
    -with-timeline logs/timeline.html \
    -with-dag logs/dag.png \
    2>&1 | tee logs/nextflow_job_xxx.log

echo "Pipeline finished at $(date)"
```

---

## 7. Monitoring & Status

### 7.1 Monitoring Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Monitoring Architecture                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Monitor Thread                         â”‚â”‚
â”‚  â”‚  (runs every 5 seconds while job active)                â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚  1. Check SLURM status (squeue -j JOB_ID)              â”‚â”‚
â”‚  â”‚  2. If not in queue, check sacct for final status      â”‚â”‚
â”‚  â”‚  3. Parse Nextflow log for progress                    â”‚â”‚
â”‚  â”‚  4. Detect errors from log patterns                    â”‚â”‚
â”‚  â”‚  5. Update job status in memory                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  UI Auto-Refresh                        â”‚â”‚
â”‚  â”‚  (gr.Timer every 15 seconds)                            â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚  â€¢ Re-parse logs for pending/running jobs              â”‚â”‚
â”‚  â”‚  â€¢ Update jobs table                                    â”‚â”‚
â”‚  â”‚  â€¢ Update job selector dropdown                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Status Detection Patterns

```python
# Error patterns to detect failure
ERROR_PATTERNS = [
    r"Error executing process",
    r"Pipeline failed",
    r"ERROR\s*[~\-]",
    r"No such file or directory",
    r"Command error:",
    r"Execution halted",
    r"FATAL:",
    r"Exception:",
]

# Success patterns
SUCCESS_PATTERNS = [
    "Pipeline completed",
    "Workflow completed",
    "Succeeded   :",
    "Workflow finished successfully",
]
```

---

## 8. Result Analysis âš ï¸ NEEDS IMPLEMENTATION

### 8.1 Proposed Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Result Analysis Pipeline                   â”‚
â”‚                      (TO BE IMPLEMENTED)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Output Discovery                       â”‚â”‚
â”‚  â”‚  â€¢ Scan workflow output directories                     â”‚â”‚
â”‚  â”‚  â€¢ Identify file types (BAM, VCF, counts, etc.)        â”‚â”‚
â”‚  â”‚  â€¢ Catalog with metadata                                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  QC Report Parser                       â”‚â”‚
â”‚  â”‚  â€¢ Parse MultiQC JSON/HTML                              â”‚â”‚
â”‚  â”‚  â€¢ Extract FastQC metrics                               â”‚â”‚
â”‚  â”‚  â€¢ Aggregate per-sample QC                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                 Analysis-Specific                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚â”‚
â”‚  â”‚  â”‚ RNA-seq â”‚ â”‚ChIP-seq â”‚ â”‚Variants â”‚ â”‚ scRNA   â”‚       â”‚â”‚
â”‚  â”‚  â”‚  DESeq2 â”‚ â”‚  Peaks  â”‚ â”‚  Stats  â”‚ â”‚ Clustersâ”‚       â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Proposed Implementation

```python
# src/workflow_composer/analysis/__init__.py

from dataclasses import dataclass
from typing import Dict, List, Optional
from pathlib import Path

@dataclass
class AnalysisResult:
    """Container for analysis results."""
    workflow_id: str
    analysis_type: str
    output_dir: Path
    qc_summary: Optional[Dict] = None
    result_files: List[Path] = None
    statistics: Dict = None

class ResultAnalyzer:
    """Analyze pipeline outputs."""
    
    def __init__(self, workflow_dir: str):
        self.workflow_dir = Path(workflow_dir)
    
    def discover_outputs(self) -> List[Path]:
        """Find all output files."""
        outputs = []
        for pattern in ["**/*.bam", "**/*.vcf*", "**/*counts*", "**/*.html"]:
            outputs.extend(self.workflow_dir.glob(pattern))
        return outputs
    
    def parse_multiqc(self) -> Dict:
        """Parse MultiQC report."""
        multiqc_data = self.workflow_dir / "results" / "multiqc" / "multiqc_data.json"
        if multiqc_data.exists():
            return json.load(open(multiqc_data))
        return {}
    
    def get_deseq2_results(self) -> Optional[pd.DataFrame]:
        """Parse DESeq2 results for RNA-seq."""
        deseq_file = self.workflow_dir / "results" / "deseq2" / "results.csv"
        if deseq_file.exists():
            return pd.read_csv(deseq_file)
        return None
    
    def get_peak_statistics(self) -> Optional[Dict]:
        """Get peak calling statistics for ChIP-seq."""
        peak_file = self.workflow_dir / "results" / "peaks" / "*_peaks.narrowPeak"
        # Count peaks, average width, etc.
        pass
```

---

## 9. Visualization âš ï¸ NEEDS IMPLEMENTATION

### 9.1 Proposed Visualization Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Visualization System                       â”‚
â”‚                      (TO BE IMPLEMENTED)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Workflow Visualization                     â”‚â”‚
â”‚  â”‚  â€¢ DAG diagram (already exists, needs UI integration)  â”‚â”‚
â”‚  â”‚  â€¢ Process timeline                                     â”‚â”‚
â”‚  â”‚  â€¢ Resource usage graphs                                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              QC Visualization                           â”‚â”‚
â”‚  â”‚  â€¢ Read quality distributions                           â”‚â”‚
â”‚  â”‚  â€¢ Mapping rate bar charts                              â”‚â”‚
â”‚  â”‚  â€¢ Coverage plots                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Analysis-Specific Plots                    â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚ RNA-seq: Volcano plot, PCA, heatmap               â”‚ â”‚â”‚
â”‚  â”‚  â”‚ ChIP-seq: Peak distribution, motif logos         â”‚ â”‚â”‚
â”‚  â”‚  â”‚ Variants: Allele frequency, transition/transversionâ”‚â”‚â”‚
â”‚  â”‚  â”‚ scRNA: UMAP/tSNE, cluster markers                 â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Proposed UI Integration

```python
# New Results tab in Gradio UI

with gr.TabItem("ğŸ“Š Results", id="results"):
    gr.Markdown("## Pipeline Results & Analysis")
    
    with gr.Row():
        # Left: Result browser
        with gr.Column(scale=4):
            completed_jobs = gr.Dropdown(
                choices=get_completed_jobs(),
                label="Select Completed Job"
            )
            
            with gr.Accordion("ğŸ“ Output Files", open=True):
                file_tree = gr.Dataframe(
                    headers=["File", "Type", "Size"],
                    interactive=False
                )
            
            with gr.Accordion("ğŸ“‹ QC Summary", open=True):
                qc_summary = gr.HTML()  # MultiQC iframe or parsed
        
        # Right: Visualizations
        with gr.Column(scale=6):
            with gr.Tab("QC Plots"):
                qc_plot = gr.Plot()
            
            with gr.Tab("Analysis Results"):
                analysis_plot = gr.Plot()  # Volcano, heatmap, etc.
            
            with gr.Tab("Reports"):
                report_viewer = gr.HTML()  # MultiQC HTML embed
```

---

## 10. Summary: Complete Pipeline Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BioPipelines Complete Flow                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  1. QUERY    "ChIP-seq for H3K4me3 in human"                                 â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  2. PARSE    â†’ AnalysisType.CHIP_SEQ, organism="human", antibody="H3K4me3"   â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  3. TOOLS    â†’ FastQC, Bowtie2, MACS2, HOMER, MultiQC                        â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  4. MODULES  â†’ modules/qc/fastqc, modules/alignment/bowtie2, ...             â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  5. GENERATE â†’ chipseq_20251125_123456/main.nf + config + samplesheet        â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  6. DATA     â†’ Download hg38 genome, bowtie2 index (if needed) âš ï¸ MANUAL     â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  7. EXECUTE  â†’ sbatch â†’ SLURM job â†’ Nextflow â†’ Singularity containers        â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  8. MONITOR  â†’ Auto-refresh, log parsing, status updates                     â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  9. RESULTS  â†’ Output files in results/ directory âŒ NO UI                    â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  10. ANALYZE â†’ Parse QC, count peaks, generate statistics âŒ NOT IMPLEMENTED  â”‚
â”‚      â”‚                                                                        â”‚
â”‚      â–¼                                                                        â”‚
â”‚  11. VISUALIZE â†’ Plots, reports, interactive exploration âŒ PARTIAL          â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Next Steps

1. **Phase 1 (Priority):** Implement Result Analysis module
2. **Phase 2:** Integrate Data Downloader into UI
3. **Phase 3:** Add Visualization components
4. **Phase 4:** Improve monitoring reliability

---

*Document generated: November 25, 2025*
