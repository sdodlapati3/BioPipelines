# BioPipelines: Architecture & Complete Guide

> **One Document to Rule Them All**  
> Everything you need to understand, use, and extend the BioPipelines AI Workflow Composer.

---

## Table of Contents

1. [Quick Start](#1-quick-start-2-minutes)
2. [System Overview](#2-system-overview)
3. [Request Lifecycle](#3-request-lifecycle-flowchart)
4. [Component Deep Dive](#4-component-deep-dive)
   - [4.1 Frontend (Gradio Web UI)](#41-frontend-gradio-web-ui)
   - [4.2 LLM Provider System](#42-llm-provider-system)
   - [4.3 Core Processing Pipeline](#43-core-processing-pipeline)
   - [4.4 Error Diagnosis System](#44-error-diagnosis-system)
   - [4.5 Results Visualization](#45-results-visualization)
   - [4.6 Data Discovery System](#46-data-discovery-system) â­
   - [4.7 Container Architecture](#47-container-architecture)
5. [Configuration](#5-configuration-reference)
6. [Troubleshooting](#6-troubleshooting)
7. [Developer Guide](#7-developer-guide)

---

## 1. Quick Start (2 Minutes)

### Prerequisites
```bash
# Conda environment (already set up on HPC)
conda activate biopipelines

# Set at least one API key
export LIGHTNING_API_KEY="your-key"  # Free 30M tokens!
# or
export OPENAI_API_KEY="your-key"
```

### Launch the Web UI
```bash
cd /home/sdodl001_odu_edu/BioPipelines
./scripts/start_gradio.sh
```

### Generate Your First Workflow
1. Open the URL shown (e.g., `http://localhost:7860`)
2. Type: `"RNA-seq differential expression for mouse, paired-end reads"`
3. Click Generate â†’ Download â†’ Submit to SLURM

That's it! The system handles intent parsing, tool selection, module mapping, and Nextflow generation automatically.

---

## 2. System Overview

### Philosophy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DESIGN PRINCIPLES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Natural Language First  - Describe what, not how               â”‚
â”‚  2. LLM-Agnostic            - Switch providers without code changes â”‚
â”‚  3. Container-Isolated      - Reproducible via Singularity         â”‚
â”‚  4. HPC-Native              - Built for SLURM clusters             â”‚
â”‚  5. Self-Healing            - Auto-diagnose and fix failures       â”‚
â”‚  6. Data-Connected          - Discover & download public datasets  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Gradio UI  â”‚    â”‚    CLI      â”‚    â”‚  Python API â”‚                   â”‚
â”‚  â”‚  (Web)      â”‚    â”‚ biocomposer â”‚    â”‚  Composer() â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           COMPOSER CORE                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                         Composer                                 â”‚     â”‚
â”‚  â”‚  â€¢ Orchestrates all components                                  â”‚     â”‚
â”‚  â”‚  â€¢ Manages LLM lifecycle                                        â”‚     â”‚
â”‚  â”‚  â€¢ Handles pre-flight validation                                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚              â”‚              â”‚              â”‚                   â”‚
â”‚          â–¼              â–¼              â–¼              â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Intent    â”‚  â”‚   Tool     â”‚  â”‚  Module    â”‚  â”‚ Workflow   â”‚         â”‚
â”‚  â”‚  Parser    â”‚  â”‚  Selector  â”‚  â”‚  Mapper    â”‚  â”‚ Generator  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATA DISCOVERY  â”‚  â”‚                 LLM PROVIDER LAYER                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   ENCODE   â”‚  â”‚  â”‚  â”‚Lightning â”‚  â”‚ OpenAI   â”‚  â”‚Anthropic â”‚           â”‚
â”‚  â”‚    GEO     â”‚  â”‚  â”‚  â”‚(Default) â”‚  â”‚ GPT-4    â”‚  â”‚ Claude   â”‚           â”‚
â”‚  â”‚    SRA     â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”‚  Ensembl   â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  Ollama  â”‚  â”‚  vLLM    â”‚                         â”‚
â”‚    Find & Download â”‚  â”‚ â”‚ (Local)  â”‚  â”‚ (GPU)    â”‚                         â”‚
â”‚   Public Datasets â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EXECUTION LAYER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚    Nextflow     â”‚â”€â”€â”€â–¶â”‚     SLURM       â”‚â”€â”€â”€â–¶â”‚  Singularity    â”‚       â”‚
â”‚  â”‚   (Workflow)    â”‚    â”‚   (Scheduler)   â”‚    â”‚  (Containers)   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONITORING & RESULTS                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Job Monitor    â”‚  â”‚ Error Diagnosisâ”‚  â”‚ Result Viewer  â”‚              â”‚
â”‚  â”‚ (Live Status)  â”‚  â”‚ (AI-Powered)   â”‚  â”‚ (Visualization)â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Request Lifecycle Flowchart

### Complete Flow: Query â†’ Results

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REQUEST LIFECYCLE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Input: "RNA-seq differential expression for mouse, treatment vs control"
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 1: INTENT PARSING                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ IntentParser.parse(query)                                               â”‚ â”‚
â”‚ â”‚                                                                         â”‚ â”‚
â”‚ â”‚  1. Send query to LLM with bioinformatics context                      â”‚ â”‚
â”‚ â”‚  2. Extract structured intent:                                          â”‚ â”‚
â”‚ â”‚     â€¢ analysis_type: "rna_seq"                                         â”‚ â”‚
â”‚ â”‚     â€¢ organism: "mus musculus"                                         â”‚ â”‚
â”‚ â”‚     â€¢ data_type: "paired_end"                                          â”‚ â”‚
â”‚ â”‚     â€¢ comparison: "treatment_vs_control"                               â”‚ â”‚
â”‚ â”‚     â€¢ confidence: 0.92                                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Files: src/workflow_composer/core/query_parser.py                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ ParsedIntent
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 2: TOOL SELECTION                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ToolSelector.find_tools_for_analysis("rna_seq")                        â”‚ â”‚
â”‚ â”‚                                                                         â”‚ â”‚
â”‚ â”‚  1. Query tool catalog (9,909 tools)                                   â”‚ â”‚
â”‚ â”‚  2. Filter by analysis type + compatibility                            â”‚ â”‚
â”‚ â”‚  3. Return categorized tools:                                          â”‚ â”‚
â”‚ â”‚     â€¢ qc: [fastqc, multiqc, fastp]                                     â”‚ â”‚
â”‚ â”‚     â€¢ alignment: [star, hisat2]                                        â”‚ â”‚
â”‚ â”‚     â€¢ quantification: [featurecounts, salmon]                          â”‚ â”‚
â”‚ â”‚     â€¢ differential: [deseq2, edger]                                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Files: src/workflow_composer/core/tool_selector.py                          â”‚
â”‚ Data:  data/tool_catalog/bioconda_tools.json                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ Dict[category, List[Tool]]
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 3: MODULE MAPPING                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ModuleMapper.find_modules_for_tools(tool_names)                        â”‚ â”‚
â”‚ â”‚                                                                         â”‚ â”‚
â”‚ â”‚  1. Check existing Nextflow modules                                    â”‚ â”‚
â”‚ â”‚  2. Map tools â†’ modules:                                               â”‚ â”‚
â”‚ â”‚     â€¢ fastqc â†’ FASTQC (exists)                                         â”‚ â”‚
â”‚ â”‚     â€¢ star â†’ STAR_ALIGN (exists)                                       â”‚ â”‚
â”‚ â”‚     â€¢ deseq2 â†’ [MISSING - will auto-create]                            â”‚ â”‚
â”‚ â”‚  3. Auto-generate missing modules via LLM                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Files: src/workflow_composer/core/module_mapper.py                          â”‚
â”‚ Modules: nextflow-pipelines/modules/                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ List[Module]
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 4: WORKFLOW GENERATION                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ WorkflowGenerator.generate(intent, modules, llm)                       â”‚ â”‚
â”‚ â”‚                                                                         â”‚ â”‚
â”‚ â”‚  1. Select workflow template based on analysis type                    â”‚ â”‚
â”‚ â”‚  2. Assemble module imports                                            â”‚ â”‚
â”‚ â”‚  3. Generate main.nf with:                                             â”‚ â”‚
â”‚ â”‚     â€¢ Parameter definitions                                            â”‚ â”‚
â”‚ â”‚     â€¢ Channel declarations                                             â”‚ â”‚
â”‚ â”‚     â€¢ Process workflow (DAG)                                           â”‚ â”‚
â”‚ â”‚  4. Generate nextflow.config with container paths                      â”‚ â”‚
â”‚ â”‚  5. Write to output directory                                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Files: src/workflow_composer/core/workflow_generator.py                     â”‚
â”‚ Templates: src/workflow_composer/templates/                                 â”‚
â”‚ Output: generated_workflows/<workflow_name>/                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ Workflow object + files on disk
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 5: EXECUTION                                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PipelineExecutor.submit_job(workflow_dir)                              â”‚ â”‚
â”‚ â”‚                                                                         â”‚ â”‚
â”‚ â”‚  1. Generate SLURM batch script                                        â”‚ â”‚
â”‚ â”‚  2. Submit via sbatch                                                  â”‚ â”‚
â”‚ â”‚  3. Nextflow orchestrates:                                             â”‚ â”‚
â”‚ â”‚     reads â”€â”¬â”€â–¶ FASTQC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ MULTIQC      â”‚ â”‚
â”‚ â”‚            â”‚                                                â–²          â”‚ â”‚
â”‚ â”‚            â””â”€â–¶ FASTP â”€â–¶ STAR_ALIGN â”€â–¶ FEATURECOUNTS â”€â–¶ DESEQ2         â”‚ â”‚
â”‚ â”‚                                                                         â”‚ â”‚
â”‚ â”‚  4. Each process runs in Singularity container                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Files: src/workflow_composer/web/gradio_app.py (PipelineExecutor)           â”‚
â”‚ Containers: containers/images/*.sif                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ Running Job
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 6: MONITORING                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ WorkflowMonitor                                                        â”‚ â”‚
â”‚ â”‚                                                                         â”‚ â”‚
â”‚ â”‚  â€¢ Parse Nextflow logs for progress                                    â”‚ â”‚
â”‚ â”‚  â€¢ Track process completion                                            â”‚ â”‚
â”‚ â”‚  â€¢ Update UI in real-time                                              â”‚ â”‚
â”‚ â”‚  â€¢ Detect failures                                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Files: src/workflow_composer/monitor/                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ Job Completed/Failed
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ SUCCESS                     â”‚ FAILURE                     â”‚
     â–¼                             â–¼                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ STAGE 7a: RESULTS    â”‚  â”‚ STAGE 7b: DIAGNOSIS  â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚ â”‚ ResultCollector  â”‚ â”‚  â”‚ â”‚ ErrorDiagnosis   â”‚ â”‚              â”‚
â”‚ â”‚ â€¢ Scan outputs   â”‚ â”‚  â”‚ â”‚ Agent            â”‚ â”‚              â”‚
â”‚ â”‚ â€¢ Categorize     â”‚ â”‚  â”‚ â”‚ â€¢ Parse logs     â”‚ â”‚              â”‚
â”‚ â”‚ â€¢ Generate viz   â”‚ â”‚  â”‚ â”‚ â€¢ Classify error â”‚ â”‚              â”‚
â”‚ â”‚ â€¢ Archive        â”‚ â”‚  â”‚ â”‚ â€¢ Suggest fixes  â”‚ â”‚              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚ â€¢ Auto-fix       â”‚ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚ Files:                  â”‚ Files:                â”‚              â”‚
â”‚ src/.../results/        â”‚ src/.../diagnosis/    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                    â”‚                            â”‚
                                    â–¼                            â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
                            â”‚ Apply Fix     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Re-run with   â”‚      (retry loop)
                            â”‚ -resume       â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Component Deep Dive

### 4.1 Frontend (Gradio Web UI)

**Location:** `src/workflow_composer/web/gradio_app.py`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GRADIO UI TABS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ğŸ’¬ Chat          Generate workflows via natural language conversation       â”‚
â”‚  â”œâ”€ Provider selector (Lightning/OpenAI/Anthropic/Ollama)                   â”‚
â”‚  â”œâ”€ Chat history                                                            â”‚
â”‚  â”œâ”€ Example prompts                                                         â”‚
â”‚  â””â”€ Workflow preview & download                                             â”‚
â”‚                                                                              â”‚
â”‚  ğŸ”§ Tools         Browse 9,909 bioinformatics tools                         â”‚
â”‚  â”œâ”€ Fuzzy search                                                            â”‚
â”‚  â”œâ”€ Container filter                                                        â”‚
â”‚  â””â”€ Tool details                                                            â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“¦ Modules       Explore available Nextflow modules                         â”‚
â”‚  â”œâ”€ Category browser                                                        â”‚
â”‚  â””â”€ Module documentation                                                    â”‚
â”‚                                                                              â”‚
â”‚  ğŸš€ Execute       Submit & monitor pipeline jobs                            â”‚
â”‚  â”œâ”€ Workflow selector                                                       â”‚
â”‚  â”œâ”€ Parameter configuration                                                 â”‚
â”‚  â”œâ”€ SLURM job queue                                                         â”‚
â”‚  â””â”€ Live progress monitoring                                                â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š Results       Visualize pipeline outputs                                â”‚
â”‚  â”œâ”€ Result scanner                                                          â”‚
â”‚  â”œâ”€ File browser                                                            â”‚
â”‚  â””â”€ Report viewer (MultiQC, etc.)                                           â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” Diagnosis     AI-powered error analysis                                 â”‚
â”‚  â”œâ”€ Log analysis                                                            â”‚
â”‚  â”œâ”€ Root cause detection                                                    â”‚
â”‚  â”œâ”€ Fix suggestions                                                         â”‚
â”‚  â””â”€ Auto-fix execution                                                      â”‚
â”‚                                                                              â”‚
â”‚  ğŸ—‚ï¸ Data Discovery Reference genome browser                                â”‚
â”‚  â”œâ”€ Search across databases                                                 â”‚
â”‚  â””â”€ Download manager                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 LLM Provider System

**Location:** `src/workflow_composer/llm/`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LLM ADAPTER PATTERN                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LLMAdapter (base.py)          Abstract base class                          â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”œâ”€â”€ LightningAdapter     âš¡ Lightning.ai (FREE, default)              â”‚
â”‚       â”‚   â””â”€ Model: llama-3.1-8b-instruct (30M free tokens)                 â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”œâ”€â”€ OpenAIAdapter        ğŸŸ¢ OpenAI                                    â”‚
â”‚       â”‚   â””â”€ Models: gpt-4o, gpt-4-turbo, gpt-3.5-turbo                     â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”œâ”€â”€ AnthropicAdapter     ğŸ”µ Anthropic                                 â”‚
â”‚       â”‚   â””â”€ Models: claude-3-opus, claude-3-sonnet                         â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”œâ”€â”€ OllamaAdapter        ğŸŸ  Ollama (local)                            â”‚
â”‚       â”‚   â””â”€ Models: llama3, mistral, codellama                             â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â””â”€â”€ vLLMAdapter          ğŸŸ£ vLLM (local GPU)                          â”‚
â”‚           â””â”€ Models: any HuggingFace model                                   â”‚
â”‚                                                                              â”‚
â”‚  factory.py: get_llm(provider, model) â†’ LLMAdapter                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Usage:**
```python
from workflow_composer.llm import get_llm

# Use Lightning.ai (free)
llm = get_llm("lightning")

# Use OpenAI GPT-4
llm = get_llm("openai", model="gpt-4o")

# Use local Ollama
llm = get_llm("ollama", model="llama3")
```

### 4.3 Core Processing Pipeline

**Location:** `src/workflow_composer/core/`

| Component | File | Purpose |
|-----------|------|---------|
| **IntentParser** | `query_parser.py` | NL â†’ structured intent |
| **ToolSelector** | `tool_selector.py` | Intent â†’ tool recommendations |
| **ModuleMapper** | `module_mapper.py` | Tools â†’ Nextflow modules |
| **WorkflowGenerator** | `workflow_generator.py` | Modules â†’ complete workflow |
| **PreflightValidator** | `preflight_validator.py` | Validate before execution |

### 4.4 Error Diagnosis System

**Location:** `src/workflow_composer/diagnosis/`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ERROR DIAGNOSIS PIPELINE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LogCollector (log_collector.py)                                            â”‚
â”‚       â”‚ Gather Nextflow + SLURM + process logs                              â”‚
â”‚       â–¼                                                                      â”‚
â”‚  PatternMatcher (patterns.py)                                               â”‚
â”‚       â”‚ 50+ regex patterns for common errors                                â”‚
â”‚       â–¼                                                                      â”‚
â”‚  ErrorDiagnosisAgent (agent.py)                                             â”‚
â”‚       â”‚ LLM-powered root cause analysis                                     â”‚
â”‚       â”‚ Categories: RESOURCE, CONFIG, DATA, TOOL, NETWORK, etc.             â”‚
â”‚       â–¼                                                                      â”‚
â”‚  AutoFixEngine (auto_fix.py)                                                â”‚
â”‚       â”‚ Safe automatic fixes (chmod, mkdir, retry, etc.)                    â”‚
â”‚       â–¼                                                                      â”‚
â”‚  GitHubAgent (github_agent.py)                                              â”‚
â”‚         Create issues for unresolved errors                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 Results Visualization

**Location:** `src/workflow_composer/results/`

| Component | File | Purpose |
|-----------|------|---------|
| **ResultCollector** | `collector.py` | Scan and categorize output files |
| **ResultDetector** | `detector.py` | Identify file types (QC, alignment, etc.) |
| **ResultViewer** | `viewer.py` | Generate preview content |
| **ResultArchiver** | `archiver.py` | Create downloadable archives |
| **CloudTransfer** | `cloud_transfer.py` | Upload to GCS/S3 |

### 4.6 Data Discovery System

**Location:** `src/workflow_composer/data/`

Data Discovery is a **foundational capability** that helps users find public datasets before generating workflows. It enables reproducible research by linking to ENCODE, GEO, and Ensembl data.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA DISCOVERY ARCHITECTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  User Query: "human liver ChIP-seq H3K27ac data"                            â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ QueryParser (query_parser.py)                                        â”‚    â”‚
â”‚  â”‚   â€¢ Parse natural language to SearchQuery                           â”‚    â”‚
â”‚  â”‚   â€¢ Extract: organism, assay_type, target, tissue                   â”‚    â”‚
â”‚  â”‚   â€¢ Suggest relevant data sources                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼ SearchQuery                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ DataDiscovery Orchestrator (orchestrator.py)                        â”‚    â”‚
â”‚  â”‚   â€¢ Route query to appropriate adapters                             â”‚    â”‚
â”‚  â”‚   â€¢ Parallel search across sources                                  â”‚    â”‚
â”‚  â”‚   â€¢ Rank and deduplicate results                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â–¼                  â–¼                  â–¼                  â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ENCODE  â”‚      â”‚   GEO    â”‚      â”‚   SRA    â”‚      â”‚ Ensembl  â”‚        â”‚
â”‚  â”‚ Adapter  â”‚      â”‚ Adapter  â”‚      â”‚ Adapter  â”‚      â”‚ Adapter  â”‚        â”‚
â”‚  â”‚          â”‚      â”‚          â”‚      â”‚          â”‚      â”‚          â”‚        â”‚
â”‚  â”‚ ChIP-seq â”‚      â”‚ Any type â”‚      â”‚ Raw      â”‚      â”‚ Genomes  â”‚        â”‚
â”‚  â”‚ ATAC-seq â”‚      â”‚ Processedâ”‚      â”‚ FASTQ    â”‚      â”‚ GTF/GFF  â”‚        â”‚
â”‚  â”‚ RNA-seq  â”‚      â”‚ + Raw    â”‚      â”‚ data     â”‚      â”‚ Indexes  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚                  â”‚                  â”‚                  â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ SearchResults                                                        â”‚    â”‚
â”‚  â”‚   â€¢ List[DatasetInfo] - ranked by relevance                         â”‚    â”‚
â”‚  â”‚   â€¢ Download URLs for each dataset                                  â”‚    â”‚
â”‚  â”‚   â€¢ Metadata (organism, assay, tissue, files)                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Download Manager                                                     â”‚    â”‚
â”‚  â”‚   â€¢ HTTP/HTTPS/FTP downloads                                        â”‚    â”‚
â”‚  â”‚   â€¢ SRA toolkit integration (fasterq-dump)                          â”‚    â”‚
â”‚  â”‚   â€¢ Progress tracking                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Module Structure:**
```
src/workflow_composer/data/
â”œâ”€â”€ __init__.py           # Package exports
â”œâ”€â”€ downloader.py         # Basic file downloader
â”œâ”€â”€ discovery/            # Data discovery system
â”‚   â”œâ”€â”€ __init__.py       # 25+ exports
â”‚   â”œâ”€â”€ models.py         # DataSource, SearchQuery, DatasetInfo
â”‚   â”œâ”€â”€ query_parser.py   # NL â†’ structured query
â”‚   â”œâ”€â”€ orchestrator.py   # DataDiscovery main class
â”‚   â””â”€â”€ adapters/         # Source-specific adapters
â”‚       â”œâ”€â”€ encode.py     # ENCODE Portal API
â”‚       â”œâ”€â”€ geo.py        # NCBI GEO/SRA API
â”‚       â””â”€â”€ ensembl.py    # Ensembl REST API
â””â”€â”€ browser/              # Gradio UI components
    â””â”€â”€ reference_browser.py
```

**Supported Data Sources:**

| Source | ID Format | Data Types |
|--------|-----------|------------|
| **ENCODE** | ENCSR*, ENCFF* | ChIP-seq, ATAC-seq, RNA-seq, Hi-C |
| **GEO** | GSE*, GSM* | All experiment types |
| **SRA** | SRR*, SRX* | Raw FASTQ data |
| **Ensembl** | - | Reference genomes, GTF annotations |

**Usage Examples:**

```python
from workflow_composer.data import DataDiscovery, quick_search

# Initialize discovery
discovery = DataDiscovery()

# Natural language search
results = discovery.search("human liver ChIP-seq H3K27ac")

# Browse results
for dataset in results.datasets:
    print(f"{dataset.source.value}: {dataset.id}")
    print(f"  Title: {dataset.title}")
    print(f"  Organism: {dataset.organism}")
    print(f"  Files: {len(dataset.download_urls)}")
    print(f"  URL: {dataset.web_url}")

# Download a dataset
job = discovery.download(
    results.datasets[0], 
    output_dir="/data/downloads"
)

# Quick search convenience function
results = quick_search("mouse RNA-seq brain")

# Source-specific search
from workflow_composer.data import search_encode, search_geo
encode_results = search_encode("H3K4me3 human")
geo_results = search_geo("single-cell RNA-seq cancer")

# Get reference genomes
from workflow_composer.data import search_references
refs = search_references(organism="human")
```

**Integration with Workflow Generation:**

Data Discovery can be used as "Stage 0" before workflow generation:

```python
from workflow_composer import Composer
from workflow_composer.data import DataDiscovery

# 1. Find data
discovery = DataDiscovery()
results = discovery.search("human liver ChIP-seq H3K27ac ENCODE")

# 2. Download data
job = discovery.download(results.datasets[0], output_dir="./data")

# 3. Generate workflow for that data
composer = Composer()
workflow = composer.generate(
    f"ChIP-seq peak calling for {results.datasets[0].organism} "
    f"with {results.datasets[0].target} target"
)
workflow.save("./chipseq_workflow")
```

### 4.7 Container Architecture

**Location:** `containers/`

```
containers/
â”œâ”€â”€ base/              # Foundation (samtools, bcftools, bwa, etc.)
â”‚   â””â”€â”€ base.def
â”œâ”€â”€ rna-seq/           # STAR, salmon, DESeq2, edgeR
â”œâ”€â”€ chip-seq/          # MACS2, HOMER, deeptools
â”œâ”€â”€ atac-seq/          # Genrich, ChromVAR
â”œâ”€â”€ dna-seq/           # GATK, FreeBayes, VEP
â”œâ”€â”€ scrna-seq/         # Scanpy, Seurat, CellRanger
â”œâ”€â”€ methylation/       # Bismark, MethylDackel
â”œâ”€â”€ metagenomics/      # Kraken2, MetaPhlAn
â”œâ”€â”€ hic/               # HiCExplorer, Cooler
â”œâ”€â”€ long-read/         # minimap2, Flye, Medaka
â”œâ”€â”€ structural-variants/ # Delly, Sniffles
â””â”€â”€ images/            # Built .sif files (22GB total)
```

**Inheritance:**
```
base_1.0.0.sif (1.4GB)
    â”‚
    â”œâ”€â”€ rna-seq_1.0.0.sif (+200MB)
    â”œâ”€â”€ chip-seq_1.0.0.sif (+400MB)
    â”œâ”€â”€ atac-seq_1.0.0.sif (+300MB)
    â””â”€â”€ ... (all pipeline containers inherit from base)
```

---

## 5. Configuration Reference

### 5.1 Main Config: `config/composer.yaml`

```yaml
# LLM Provider Settings
llm:
  default_provider: lightning  # lightning, openai, anthropic, ollama, vllm
  
  lightning:
    model: llama-3.1-8b-instruct
    # API key from LIGHTNING_API_KEY env var
    
  openai:
    model: gpt-4o
    temperature: 0.7
    
  ollama:
    model: llama3
    base_url: http://localhost:11434

# Knowledge Base Paths
knowledge_base:
  tool_catalog: data/tool_catalog/bioconda_tools.json
  module_library: nextflow-pipelines/modules
  workflow_patterns: src/workflow_composer/templates

# Execution Settings
execution:
  default_profile: slurm
  container_dir: containers/images
  work_dir: /scratch/$USER/nextflow_work
```

### 5.2 SLURM Config: `config/slurm.yaml`

```yaml
default_partition: cpuspot       # CPU jobs (downloads, etc.)
gpu_partition: h100quadflex      # GPU jobs (LLM inference, etc.)
default_time: "48:00:00"
default_memory: "8G"

profiles:
  small:
    cpus: 4
    memory: 16G
    time: "4:00:00"
  large:
    cpus: 32
    memory: 128G
    time: "72:00:00"
  gpu:
    partition: gpu
    gres: gpu:1
```

### 5.3 Environment Variables

| Variable | Purpose | Required |
|----------|---------|----------|
| `LIGHTNING_API_KEY` | Lightning.ai API (free tier) | Recommended |
| `OPENAI_API_KEY` | OpenAI API | Optional |
| `ANTHROPIC_API_KEY` | Anthropic API | Optional |
| `GITHUB_TOKEN` | GitHub issue creation | Optional |
| `GOOGLE_CLOUD_PROJECT` | GCS uploads | Optional |

---

## 6. Troubleshooting

### Common Issues

#### "No LLM providers available"
```bash
# Check API keys
echo $LIGHTNING_API_KEY
echo $OPENAI_API_KEY

# Set Lightning.ai key (free)
export LIGHTNING_API_KEY="your-key-here"

# Or add to .secrets/lightning_key
echo "your-key" > .secrets/lightning_key
```

#### "Container not found"
```bash
# Check container exists
ls -la containers/images/

# Rebuild if needed
cd containers/rna-seq
singularity build --fakeroot rna-seq_1.0.0.sif rna-seq.def
mv rna-seq_1.0.0.sif ../images/
```

#### "Module not found for tool X"
The system auto-creates missing modules via LLM. If this fails:
```bash
# Check module library
ls nextflow-pipelines/modules/

# Manually create module
biocomposer modules --create TOOL_NAME --container rna-seq
```

#### Pipeline stuck in PENDING
```bash
# Check SLURM queue
squeue -u $USER

# Check job logs
cat logs/slurm_*.out

# Cancel and retry
scancel JOB_ID
```

#### Out of Memory Error
Edit workflow's `nextflow.config`:
```groovy
process {
    withName: 'STAR_ALIGN' {
        memory = '64 GB'
    }
}
```

### Debug Mode

```bash
# Enable verbose logging
export BIOPIPELINES_DEBUG=1

# Run with debug output
python -m workflow_composer.web.gradio_app --debug
```

---

## 7. Developer Guide

### Directory Structure

```
BioPipelines/
â”œâ”€â”€ src/workflow_composer/     # Main source code
â”‚   â”œâ”€â”€ __init__.py           # Package exports
â”‚   â”œâ”€â”€ composer.py           # Main orchestrator
â”‚   â”œâ”€â”€ config.py             # Configuration loader
â”‚   â”œâ”€â”€ cli.py                # Command-line interface
â”‚   â”œâ”€â”€ core/                 # Processing pipeline
â”‚   â”œâ”€â”€ llm/                  # LLM adapters
â”‚   â”œâ”€â”€ diagnosis/            # Error diagnosis
â”‚   â”œâ”€â”€ results/              # Results visualization
â”‚   â”œâ”€â”€ data/                 # Data discovery
â”‚   â”œâ”€â”€ web/                  # Gradio UI
â”‚   â””â”€â”€ templates/            # Workflow templates
â”œâ”€â”€ containers/               # Singularity definitions
â”œâ”€â”€ nextflow-pipelines/       # Nextflow modules & workflows
â”œâ”€â”€ config/                   # Configuration files
â”œâ”€â”€ tests/                    # Test suite
â””â”€â”€ docs/                     # Documentation
```

### Adding a New LLM Provider

1. Create adapter in `src/workflow_composer/llm/`:
```python
# my_provider_adapter.py
from .base import LLMAdapter, Message, Response

class MyProviderAdapter(LLMAdapter):
    def __init__(self, model: str = "default-model"):
        self.model = model
        self.client = MyProviderClient()
    
    def chat(self, messages: List[Message]) -> Response:
        # Convert messages and call API
        result = self.client.chat(...)
        return Response(content=result.text)
```

2. Register in `factory.py`:
```python
PROVIDERS["myprovider"] = MyProviderAdapter
```

### Adding a New Analysis Type

1. Add to `AnalysisType` enum in `core/query_parser.py`
2. Create tool mapping in `tool_selector.py`
3. Add workflow template in `templates/`
4. Create container definition in `containers/`

### Running Tests

```bash
# All tests
pytest tests/ -v

# Specific module
pytest tests/test_diagnosis.py -v

# With coverage
pytest tests/ --cov=src/workflow_composer --cov-report=html
```

---

## Quick Reference Card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BIOPIPELINES QUICK REFERENCE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  START UI:        ./scripts/start_gradio.sh                                 â”‚
â”‚  CLI GENERATE:    biocomposer generate "RNA-seq for mouse"                  â”‚
â”‚  CLI CHAT:        biocomposer chat --llm lightning                          â”‚
â”‚                                                                              â”‚
â”‚  PYTHON API:                                                                â”‚
â”‚    from workflow_composer import Composer                                   â”‚
â”‚    c = Composer()                                                           â”‚
â”‚    w = c.generate("RNA-seq for mouse")                                      â”‚
â”‚    w.save("my_workflow/")                                                   â”‚
â”‚                                                                              â”‚
â”‚  KEY PATHS:                                                                 â”‚
â”‚    Config:      config/composer.yaml                                        â”‚
â”‚    Modules:     nextflow-pipelines/modules/                                 â”‚
â”‚    Containers:  containers/images/                                          â”‚
â”‚    Workflows:   generated_workflows/                                        â”‚
â”‚    Logs:        logs/                                                       â”‚
â”‚                                                                              â”‚
â”‚  SUPPORTED ANALYSES:                                                        â”‚
â”‚    RNA-seq, ChIP-seq, ATAC-seq, DNA-seq, Variant Calling,                  â”‚
â”‚    Single-cell RNA, Metagenomics, Methylation, Hi-C, Long-read             â”‚
â”‚                                                                              â”‚
â”‚  LLM PROVIDERS:                                                             â”‚
â”‚    lightning (FREE), openai, anthropic, ollama (local), vllm (GPU)         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*Document Version: 1.0 | Last Updated: November 2025*
