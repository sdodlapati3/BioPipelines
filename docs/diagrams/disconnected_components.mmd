%%{init: {'theme': 'base'}}%%

flowchart TB
    subgraph CONNECTED["âœ… FULLY CONNECTED (Core System)"]
        direction TB
        
        UA["ğŸ¯ UnifiedAgent"]
        TOOLS["ğŸ”§ Tools (32)"]
        EXECUTOR["ğŸ›¡ï¸ Executor"]
        AUTONOMOUS["ğŸ”„ Autonomous"]
        PROVIDERS["ğŸ§  Providers"]
        CORE["ğŸ“š Core"]
        DATA["ğŸ—„ï¸ Data"]
        
        UA <--> TOOLS
        UA <--> EXECUTOR
        UA <--> AUTONOMOUS
        TOOLS <--> CORE
        CORE <--> PROVIDERS
        TOOLS <--> DATA
    end

    subgraph INTEGRATED["âœ… CORRECTLY INTEGRATED (Verified via grep)"]
        direction TB
        
        LLM_MODULE["llm/<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… ACTIVE (12+ imports)<br/>Used by composer, cli<br/>High-level LLM factory"]
        
        DIAG_MODULE["diagnosis/<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… INTEGRATED<br/>Via tools/diagnostics.py<br/>diagnose_error() delegates"]
        
        REACT["react_agent.py<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… USED<br/>By AutonomousAgent<br/>Multi-step ReAct pattern"]
        
        SELF_HEAL["self_healing.py<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… USED<br/>By chat_integration<br/>Complements recovery.py"]
        
        MEMORY["memory.py<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… USED<br/>By AutonomousAgent<br/>Vector RAG for context"]
        
        ENHANCED["enhanced_tools.py<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… USED<br/>By AutonomousAgent<br/>Retry + detailed errors"]
        
        MULTI_MODEL["multi_model.py<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… CONFIG MODULE<br/>H100 deployment specs<br/>Exported, not internal"]
        
        MODELS["models/<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… ENUMS + CONFIG<br/>Used across system"]
        
        TEMPLATES["templates/<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ PLACEHOLDER<br/>Reserved for future"]
    end

    subgraph DEPRECATED["âš« DEPRECATED (Labeled)"]
        direction TB
        
        DEP_DIR["deprecated/<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âš« HISTORICAL<br/>Not in import path<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ alignment/<br/>â€¢ preprocessing/<br/>â€¢ variant_calling/<br/>â€¢ expression/<br/>â€¢ peak_calling/<br/>â€¢ visualization/"]
    end

    %% Connections showing verified integration
    AUTONOMOUS -->|"uses"| REACT
    AUTONOMOUS -->|"uses"| MEMORY
    AUTONOMOUS -->|"uses"| ENHANCED
    
    TOOLS -->|"diagnose_error"| DIAG_MODULE
    
    CORE -->|"get_llm()"| LLM_MODULE
    
    LLM_MODULE -.->|"wraps"| PROVIDERS
    
    %% Styling
    classDef connected fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    classDef integrated fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef deprecated fill:#eceff1,stroke:#546e7a,stroke-width:2px,stroke-dasharray: 5 5

    class UA,TOOLS,EXECUTOR,AUTONOMOUS,PROVIDERS,CORE,DATA connected
    class LLM_MODULE,DIAG_MODULE,REACT,SELF_HEAL,MEMORY,ENHANCED,MULTI_MODEL,MODELS,TEMPLATES integrated
    class DEP_DIR deprecated

    subgraph LEGEND["Legend"]
        L1["â”â” Verified integration"]
        L2["â†’ Direct usage"]
        L3["â”ˆâ†’ Wrapper/adapter"]
        L4["âœ… Keep as-is"]
        L5["âš« No action needed"]
    end

    subgraph CONCLUSION["CONCLUSION: No Refactoring Needed"]
        C1["âœ“ All components properly connected"]
        C2["âœ“ No redundancy - complementary roles"]
        C3["âœ“ deprecated/ already labeled"]
    end
