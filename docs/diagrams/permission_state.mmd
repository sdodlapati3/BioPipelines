%%{init: {'theme': 'base'}}%%

stateDiagram-v2
    [*] --> READONLY: Default safe mode

    state "ðŸ”’ READONLY" as READONLY {
        note right of READONLY
            Permissions: {read}
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
            âœ“ scan_data
            âœ“ search_databases
            âœ“ describe_files
            âœ“ get_job_status
            âœ“ explain_concept
            âœ— All write/execute
        end note
    }

    state "ðŸ“‹ MONITORED" as MONITORED {
        note right of MONITORED
            Permissions: {read}
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
            Same as READONLY
            + All actions logged
            + Detailed audit trail
        end note
    }

    state "âœï¸ ASSISTED" as ASSISTED {
        note right of ASSISTED
            Permissions: {read, write}
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
            âœ“ All read operations
            âœ“ download_dataset
            âœ“ generate_workflow
            âš ï¸ execute needs approval
            âœ— delete operations
        end note
    }

    state "ðŸ‘€ SUPERVISED" as SUPERVISED {
        note right of SUPERVISED
            Permissions: {read, write, execute}
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
            âœ“ All read/write
            âœ“ submit_job
            âœ“ cancel_job
            âœ“ restart_vllm
            âš ï¸ delete needs approval
        end note
    }

    state "ðŸ¤– AUTONOMOUS" as AUTONOMOUS {
        note right of AUTONOMOUS
            Permissions: {read, write, execute, delete}
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
            âœ“ All operations
            âš ï¸ delete still logged
            âš ï¸ dangerous cmds blocked
        end note
    }

    READONLY --> MONITORED: set_autonomy_level(MONITORED)
    MONITORED --> ASSISTED: set_autonomy_level(ASSISTED)
    ASSISTED --> SUPERVISED: set_autonomy_level(SUPERVISED)
    SUPERVISED --> AUTONOMOUS: set_autonomy_level(AUTONOMOUS)
    
    AUTONOMOUS --> SUPERVISED: Reduce permissions
    SUPERVISED --> ASSISTED: Reduce permissions
    ASSISTED --> MONITORED: Reduce permissions
    MONITORED --> READONLY: Reduce permissions

    state "Approval Workflow" as APPROVAL {
        [*] --> Pending: request_approval()
        Pending --> Approved: approve()
        Pending --> Denied: deny()
        Pending --> Expired: timeout
        Approved --> [*]: Execute action
        Denied --> [*]: Block action
        Expired --> [*]: Block action
    }

    ASSISTED --> APPROVAL: Execute action at ASSISTED
    SUPERVISED --> APPROVAL: Delete action
    AUTONOMOUS --> APPROVAL: Dangerous command
